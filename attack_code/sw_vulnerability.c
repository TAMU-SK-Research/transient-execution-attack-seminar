#include <stdint.h>
#include <stdio.h>
#include <string.h>
#include <x86intrin.h>
#include <gem5/m5ops.h>

// Begin of victim
size_t array_size = 4;
uint8_t victim_arr[200] = {1, 2, 3, 4};

uint8_t secret = 123;  // <-- Attack and steal it!!
uint8_t victim(size_t idx)
{
    if (idx < array_size)
        return victim_arr[idx];
    return 0;
}
// End of victim


int main (int argc, char *argv[])
{
    // Do not erase this line
    m5_set_numflush(1);

    size_t attack_idx = &secret - victim_arr;
    uint8_t val = victim(attack_idx);
    printf("val: %d\n", val);

    return 0;
}
